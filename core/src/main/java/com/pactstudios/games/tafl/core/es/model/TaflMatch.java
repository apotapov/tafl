package com.pactstudios.games.tafl.core.es.model;

import java.util.Date;

import com.badlogic.gdx.utils.Array;
import com.j256.ormlite.dao.ForeignCollection;
import com.j256.ormlite.field.DatabaseField;
import com.j256.ormlite.field.ForeignCollectionField;
import com.j256.ormlite.table.DatabaseTable;
import com.pactstudios.games.tafl.core.consts.Constants;
import com.pactstudios.games.tafl.core.es.model.board.GameBoard;
import com.pactstudios.games.tafl.core.es.model.log.MatchLogEntry;
import com.pactstudios.games.tafl.core.es.model.objects.GamePiece;
import com.pactstudios.games.tafl.core.es.model.objects.Team;
import com.pactstudios.games.tafl.core.es.model.rules.RulesEngine;
import com.pactstudios.games.tafl.core.es.model.rules.RulesEngine.RulesEngineType;
import com.pactstudios.games.tafl.core.es.systems.events.LifecycleEvent.Lifecycle;

@DatabaseTable(tableName = Constants.DbConstants.MATCH_TABLE)
public class TaflMatch {

    public static final String ID_COLUMN = "_id";
    public static final String NAME_COLUMN = "name";
    public static final String STATUS_COLUMN = "status";
    public static final String TURN_COLUMN = "turn";
    public static final String DIMENSION_COLUMN = "dim";
    public static final String RULE_ENGINE_COLUMN = "rules";
    public static final String CREATED_COLUMN = "created";
    public static final String UPDATED_COLUMN = "updated";
    public static final String TIMER_COLUMN = "timer";

    public static final String[] COLUMN_MAP = new String[] {
        NAME_COLUMN,
        STATUS_COLUMN,
        TURN_COLUMN,
        DIMENSION_COLUMN,
        RULE_ENGINE_COLUMN,
        CREATED_COLUMN,
        UPDATED_COLUMN,
        TIMER_COLUMN,
    };

    // id is generated by the database and set on the object automagically
    @DatabaseField(generatedId = true)
    public int _id;

    @DatabaseField(columnName = NAME_COLUMN, canBeNull = false)
    public String name;

    @DatabaseField(columnName = STATUS_COLUMN, canBeNull = false)
    public Lifecycle status;

    @DatabaseField(columnName = TURN_COLUMN, canBeNull = false)
    public Team turn;

    @DatabaseField(columnName = DIMENSION_COLUMN, canBeNull = false)
    public int dimensions;

    @DatabaseField(columnName = RULE_ENGINE_COLUMN, canBeNull = false)
    public RulesEngineType rules;

    @DatabaseField(columnName = CREATED_COLUMN, canBeNull = false)
    public Date created;

    @DatabaseField(columnName = UPDATED_COLUMN, canBeNull = false)
    public Date updated;

    @DatabaseField(columnName = TIMER_COLUMN, canBeNull = false)
    public float timer;

    @ForeignCollectionField
    public ForeignCollection<GamePiece> persistedPiece;

    @ForeignCollectionField
    public ForeignCollection<MatchLogEntry> persistedLog;

    public Array<GamePiece> pieces;
    public RulesEngine rulesEngine;
    public GameBoard board;

    @Override
    public int hashCode() {
        return name == null ? 0 : name.hashCode();
    }

    @Override
    public boolean equals(Object other) {
        return other != null && other instanceof TaflMatch && name != null && name.equals(((TaflMatch)other).name);
    }

    @Override
    public String toString() {
        return Integer.toString(_id);
    }
}
